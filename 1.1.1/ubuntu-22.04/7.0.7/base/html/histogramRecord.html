<html><head><title>Histogram Record (histogram)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="style.css">

</head>
<body class='pod'>
<!--
  generated by EPICS::PodHtml v,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Thu May 22 10:14:20 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to EPICS::PodHtml, and/or subclassing EPICS::PodHtml,
   then reconverting this document from the Pod source.
   When in doubt, email the author of EPICS::PodHtml for advice.
   See 'perldoc EPICS::PodHtml' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>
<div class="pod">


<h1><a class='u'
name="Histogram-Record-histogram"
>Histogram Record (histogram)</a></h1>

<p>The histogram record is used to store frequency counts of a signal into an array of arbitrary length.
The user can configure the range of the signal value that the array will store.
Anything outside this range will be ignored.</p>

<h2><a class='u'
name="Parameter-Fields"
>Parameter Fields</a></h2>

<p>The record-specific fields are described below.</p>

<h3><a class='u'
name="Read-Parameters"
>Read Parameters</a></h3>

<p>The SVL is the input link where the record reads its value.
It can be a constant,
a database link,
or a channel access link.
If SVL is a database or channel access link,
then SGNL is read from SVL.
If SVL is a constant,
then SGNL is initialized with the constant value but can be changed via dbPuts.
The <code>Soft Channel</code> device support module can be specified in the DTYP field.</p>

<p>The ULIM and LLIM fields determine the usable range of signal values.
Any value of SGNL below LLIM or above ULIM is outside the range and will not be stored in the array.
In the NELM field the user must specify the array size,
e.g.,
the number of array elements.
Each element in the NELM field holds the counts for an interval of the range of signal counts,
the range specified by ULIM and LLIM.
These intervals are determined by dividing the range by NELM:</p>

<pre>  (ULIM - LLIM) / NELM.</pre>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">SVL</td><td class="cell">Signal Value Location</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">SGNL</td><td class="cell">Signal Value</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">DTYP</td><td class="cell">Device Type</td><td class="cell">DEVICE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">NELM</td><td class="cell">Num of Array Elements</td><td class="cell">USHORT</td><td class="cell">Yes</td><td class="cell">1</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">ULIM</td><td class="cell">Upper Signal Limit</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">LLIM</td><td class="cell">Lower Signal Limit </td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Operator-Display-Parameters"
>Operator Display Parameters</a></h3>

<p>These parameters are used to present meaningful data to the operator. These fields are used to display the value and other parameters of the histogram either textually or graphically. See <a href="dbCommonRecord.html#Operator-Display-Parameters" class="podlinkpod"
>Fields Common to All Record Types</a> for more on the record name (NAME) and description (DESC) fields.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">NAME</td><td class="cell">Record Name</td><td class="cell">STRING [61]</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">DESC</td><td class="cell">Descriptor</td><td class="cell">STRING [41]</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Alarm-Parameters"
>Alarm Parameters</a></h3>

<p>The Histogram record has the alarm parameters common to all record types. <a href="dbCommonRecord.html#Alarm-Fields" class="podlinkpod"
>Alarm Fields</a> lists the fields related to alarms that are common to all record types.</p>

<h3><a class='u'
name="Monitor-Parameters"
>Monitor Parameters</a></h3>

<p>The MDEL field implements the monitor count deadband. Only when MCNT is greater than the value given to MDEL are monitors triggered, MCNT being the number of counts since the last time the record was processed. If MDEL is -1, everytime the record is processed, a monitor is triggered regardless.</p>

<p>If SDEL is greater than 0, it causes a callback routine to be called. The number specified in SDEL is the callback routines interval. The callback routine is called every SDEL seconds. The callback routine posts an event if MCNT is greater than 0.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">MDEL</td><td class="cell">Monitor Count Deadband</td><td class="cell">SHORT</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">SDEL</td><td class="cell">Monitor Seconds Dband</td><td class="cell">DOUBLE</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Run-time-and-Simulation-Mode-Parameters"
>Run-time and Simulation Mode Parameters</a></h3>

<p>These parameters are used by the run-time code for processing the histogram. They are not configurable by the user prior to run-time. They represent the current state of the record. Many of them are used to process the histogram more efficiently.</p>

<p>The BPTR field contains a pointer to the unsigned long array of frequency values. The VAL field references this array as well. However, the BPTR field is not accessible at run-time.</p>

<p>The MCNT field keeps counts the number of signal counts since the last monitor was invoked.</p>

<p>The collections controls field (CMD) is a menu field with five choices:</p>
<blockquote><table border="1"><tr>
<th>Index</th><th>Identifier</th><th>Choice String</th></tr>
<tr>
<td class='cell DBD_Menu index'>0</td>
<td class='cell DBD_Menu identifier'>histogramCMD_Read</td>
<td class='cell DBD_Menu choice'>Read</td>
</tr>
<tr>
<td class='cell DBD_Menu index'>1</td>
<td class='cell DBD_Menu identifier'>histogramCMD_Clear</td>
<td class='cell DBD_Menu choice'>Clear</td>
</tr>
<tr>
<td class='cell DBD_Menu index'>2</td>
<td class='cell DBD_Menu identifier'>histogramCMD_Start</td>
<td class='cell DBD_Menu choice'>Start</td>
</tr>
<tr>
<td class='cell DBD_Menu index'>3</td>
<td class='cell DBD_Menu identifier'>histogramCMD_Stop</td>
<td class='cell DBD_Menu choice'>Stop</td>
</tr>
</table></blockquote>


<p>When CMD is <code>Read</code>, the record retrieves its values and adds them to the signal array. This command will first clear the signal counts which have already been read when it is first invoked.</p>

<p>The <code>Clear</code> command erases the signal counts, setting the elements in the array back to zero. Afterwards, the CMD field is set back to <code>Read</code>.</p>

<p>The <code>Start</code> command simply causes the record to read signal values into the array. Unlike <code>Read</code>, it doesn&#39;t clear the array first.</p>

<p>The <code>Stop</code> command disables the reading of signal values into the array.</p>

<p>The <code>Setup</code> command waits until the <code>start</code> or <code>read</code> command has been issued to start counting.</p>

<p>The CSTA or collections status field implements the CMD field choices by enabling or disabling the reading of values into the histogram array. While FALSE, no signals are added to the array. While TRUE, signals are read and added to the array. The field is initialized to TRUE. The <code>Stop</code> command is the only command that sets CSTA to FALSE. On the other hand, the <code>Start</code> command is the only command that sets it to TRUE. Thus, <code>Start</code> must be invoked after each <code>Stop</code> command in order to enable counting; invoking <code>Read</code> will not enable signal counting after <code>Stop</code> has been invoked.</p>

<p>A typical use of these fields would be to initialize the CMD field to <code>Read</code> (it is initialized to this command by default), to use the <code>Stop</code> command to disable counting when necessary, after which the <code>Start</code> command can be invoked to re-start the signal count.</p>

<p>The WDTH field is a private field that holds the signal width of the array elements. For instance, if the LLIM was configured to be 4.0 and ULIM was configured to be 12.0 and the NELM was set to 4, then the WDTH for each array would be 2. Thus, it is (ULIM - LLIM) / NELM.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">BPTR</td><td class="cell">Buffer Pointer</td><td class="cell">NOACCESS</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">No</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">VAL</td><td class="cell">Value</td><td class="cell">ULONG[]</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">MCNT</td><td class="cell">Counts Since Monitor</td><td class="cell">SHORT</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">CMD</td><td class="cell">Collection Control</td><td class="cell">MENU (<a href='#Menu-histogramCMD'>histogramCMD</a>)</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">CSTA</td><td class="cell">Collection Status</td><td class="cell">SHORT</td><td class="cell">No</td><td class="cell">1</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">WDTH</td><td class="cell">Element Width</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

</table></blockquote>


<p>The following fields are used to operate the histogram record in simulation mode. See <a href="#Fields-Common-to-Many-Record-Types" class="podlinkpod"
>&#34;Fields Common to Many Record Types&#34;</a> for more information on the simulation mode fields.</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">SIOL</td><td class="cell">Simulation Input Link</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">SVAL</td><td class="cell">Simulation Value</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">SIML</td><td class="cell">Simulation Mode Link</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">SIMM</td><td class="cell">Simulation Mode</td><td class="cell">MENU (<a href='menuYesNo.html'>menuYesNo</a>)</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">SIMS</td><td class="cell">Simulation Mode Severity</td><td class="cell">MENU (<a href='menuAlarmSevr.html'>menuAlarmSevr</a>)</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h2><a class='u'
name="Record-Support"
>Record Support</a></h2>

<h3><a class='u'
name="Record-Support-Routines"
>Record Support Routines</a></h3>

<h4><a class='u'
name="init_record"
>init_record</a></h4>

<p>Using NELM, space for the unsigned long array is allocated and the width WDTH of the array is calculated.</p>

<p>This routine initializes SIMM with the value of SIML if SIML type is CONSTANT link or creates a channel access link if SIML type is PV_LINK. SVAL is likewise initialized if SIOL is CONSTANT or PV_LINK.</p>

<p>This routine next checks to see that device support and a device support read routine are available. If device support includes <code>init_record()</code>, it is called.</p>

<h4><a class='u'
name="process"
>process</a></h4>

<p>See next section.</p>

<h4><a class='u'
name="special"
>special</a></h4>

<p>Special is invoked whenever the fields CMD, SGNL, ULIM, or LLIM are changed.</p>

<p>If SGNL is changed, add_count is called.</p>

<p>If ULIM or LLIM are changed, WDTH is recalculated and clear_histogram is called.</p>

<p>If CMD is less or equal to 1, clear_histogram is called and CMD is reset to 0. If CMD is 2, CSTA is set to TRUE and CMD is reset to 0. If CMD is 3, CSTA is set to FALSE and CMD is reset to 0.</p>

<p>clear_histogram zeros out the histogram array. add_count increments the frequency in the histogram array.</p>

<h4><a class='u'
name="cvt_dbaddr"
>cvt_dbaddr</a></h4>

<p>This is called by dbNameToAddr. It makes the dbAddr structure refer to the actual buffer holding the array.</p>

<h4><a class='u'
name="get_array_info"
>get_array_info</a></h4>

<p>Obtains values from the array referenced by VAL.</p>

<h4><a class='u'
name="put_array_info"
>put_array_info</a></h4>

<p>Writes values into the array referenced by VAL.</p>

<h3><a class='u'
name="Record-Processing"
>Record Processing</a></h3>

<p>Routine process implements the following algorithm:</p>

<ol>
<li>Check to see that the appropriate device support module exists. If it doesn&#39;t, an error message is issued and processing is terminated with the PACT field set to TRUE. This ensures that processes will no longer be called for this record. Thus error storms will not occur.</li>

<li>readValue is called. See <a href="#Input-Records" class="podlinkpod"
>&#34;Input Records&#34;</a> for more information</li>

<li>If PACT has been changed to TRUE, the device support read routine has started but has not completed writing the new value. In this case, the processing routine merely returns, leaving PACT TRUE.</li>

<li>Add count to histogram array.</li>

<li>Check to see if monitors should be invoked. Alarm monitors are invoked if the alarm status or severity has changed. Archive and value change monitors are invoked if MDEL conditions are met. NSEV and NSTA are reset to 0.</li>

<li>Scan forward link if necessary, set PACT and INIT to FALSE, and return.</li>
</ol>

<h2><a class='u'
name="Device-Support"
>Device Support</a></h2>

<h3><a class='u'
name="Fields-Of-Interest-To-Device-Support"
>Fields Of Interest To Device Support</a></h3>

<p>The device support routines are primarily interested in the following fields:</p>
<blockquote><table border="1"><tr>
<th>Field</th><th>Summary</th><th>Type</th><th>DCT</th>
<th>Default</th><th>Read</th><th>Write</th><th>CA PP</th>
</tr>
<tr><td class="cell">PACT</td><td class="cell">Record active</td><td class="cell">UCHAR</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">DPVT</td><td class="cell">Device Private</td><td class="cell">NOACCESS</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">No</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">UDF</td><td class="cell">Undefined</td><td class="cell">UCHAR</td><td class="cell">Yes</td><td class="cell">1</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">Yes</td></tr>

<tr><td class="cell">NSEV</td><td class="cell">New Alarm Severity</td><td class="cell">MENU (<a href='menuAlarmSevr.html'>menuAlarmSevr</a>)</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">NSTA</td><td class="cell">New Alarm Status</td><td class="cell">MENU (<a href='menuAlarmStat.html'>menuAlarmStat</a>)</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">No</td><td class="cell">No</td></tr>

<tr><td class="cell">SVL</td><td class="cell">Signal Value Location</td><td class="cell">INLINK</td><td class="cell">Yes</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

<tr><td class="cell">SGNL</td><td class="cell">Signal Value</td><td class="cell">DOUBLE</td><td class="cell">No</td><td class="cell">&nbsp;</td><td class="cell">Yes</td><td class="cell">Yes</td><td class="cell">No</td></tr>

</table></blockquote>


<h3><a class='u'
name="Device-Support-Routines"
>Device Support Routines</a></h3>

<p>Device support consists of the following routines:</p>

<h4><a class='u'
name="long-report-int-level"
>long report(int level)</a></h4>

<p>This optional routine is called by the IOC command <code>dbior</code> and is passed the report level that was requested by the user. It should print a report on the state of the device support to stdout. The <code>level</code> parameter may be used to output increasingly more detailed information at higher levels, or to select different types of information with different levels. Level zero should print no more than a small summary.</p>

<h4><a class='u'
name="long-init-int-after"
>long init(int after)</a></h4>

<p>This optional routine is called twice at IOC initialization time. The first call happens before any of the <code>init_record()</code> calls are made, with the integer parameter <code>after</code> set to 0. The second call happens after all of the <code>init_record()</code> calls have been made, with <code>after</code> set to 1.</p>

<h4><a class='u'
name="init_record"
>init_record</a></h4>

<pre>  init_record(precord)</pre>

<p>This routine is called by the record support <code>init_record()</code> routine. It makes sure that SGNL is a CONSTANT, PV_LINK, DB_LINK, or CA_LINK. It also retrieves a value for SVL from SGNL. If SGNL is none of the above, an error is generated.</p>

<h4><a class='u'
name="read_histogram"
>read_histogram</a></h4>

<pre>  read_histogram(*precord)</pre>

<p>This routine is called by the record support routines. It retrieves a value for SVL from SGNL.</p>

<h3><a class='u'
name="Device-Support-For-Soft-Records"
>Device Support For Soft Records</a></h3>

<p>Only the device support module <code>Soft Channel</code> is currently provided, though other device support modules may be provided at the user&#39;s site.</p>

<h4><a class='u'
name="Soft-Channel"
>Soft Channel</a></h4>

<p>The <code>Soft Channel</code> device support routine retrieves a value from SGNL. SGNL must be CONSTANT, PV_LINK, DB_LINK, or CA_LINK.</p>
</div>


<!-- end doc -->

</body></html>
